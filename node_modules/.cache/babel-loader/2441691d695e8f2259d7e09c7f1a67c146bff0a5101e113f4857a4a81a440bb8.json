{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { reqTradeInfo, reqSubmitOrder } from '@/api';\nexport default {\n  name: 'Trade',\n  data() {\n    return {\n      tradeInfo: {},\n      orderComment: '' //买家留言\n    };\n  },\n\n  computed: {\n    showAddress() {\n      return this.tradeInfo.userAddressList?.find(item => {\n        return item.isDefault === '1';\n      }) || {};\n    }\n  },\n  methods: {\n    // 用于获取交易信息\n    async getTradeInfo() {\n      const {\n        code,\n        message,\n        data\n      } = await reqTradeInfo();\n      if (code === 200) {\n        this.tradeInfo = data;\n      } else {\n        this.$message.error(`获取交易信息失败:${message}`);\n      }\n    },\n    // 用户切换收货地址\n    changeAddress(id) {\n      this.tradeInfo.userAddressList.forEach(item => {\n        item.id === id ? item.isDefault = '1' : item.isDefault = '0';\n      });\n    },\n    // 提交订单\n    async submitOrder() {\n      // 准备好所有提交订单需要的参数\n      const {\n        orderComment\n      } = this;\n      const {\n        tradeNo,\n        detailArrayList\n      } = this.tradeInfo;\n      const {\n        userAddress,\n        phoneNum,\n        consignee\n      } = this.showAddress;\n      // 准备一个包含着所有提交订单所需参数的对象\n      const obj = {\n        consignee,\n        consigneeTel: phoneNum,\n        deliveryAddress: userAddress,\n        paymentWay: 'ONLINE',\n        orderComment,\n        orderDetailList: detailArrayList\n      };\n      // 发请求去提交订单（记得要携带【交易编号】）返回的data是订单编号\n      const {\n        code,\n        message,\n        data\n      } = await reqSubmitOrder(tradeNo, obj);\n      if (code === 200) {\n        this.$router.push('/pay?id=' + data);\n      } else {\n        this.$message.warning(`提交订单失败：${message}`);\n      }\n    }\n  },\n  mounted() {\n    this.getTradeInfo();\n  },\n  beforeRouteEnter(to, from, next) {\n    if (from.path === '/shopcart') {\n      next();\n    } else {\n      next('/home');\n    }\n  }\n};","map":{"version":3,"names":["reqTradeInfo","reqSubmitOrder","name","data","tradeInfo","orderComment","computed","showAddress","userAddressList","find","item","isDefault","methods","getTradeInfo","code","message","$message","error","changeAddress","id","forEach","submitOrder","tradeNo","detailArrayList","userAddress","phoneNum","consignee","obj","consigneeTel","deliveryAddress","paymentWay","orderDetailList","$router","push","warning","mounted","beforeRouteEnter","to","from","next","path"],"sources":["src/pages/Trade/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"trade-container\">\r\n    <h3 class=\"title\">填写并核对订单信息</h3>\r\n    <div class=\"content\">\r\n      <h5 class=\"receive\">收件人信息</h5>\r\n\r\n      <!-- 每个address容器，就是一个收货人信息 -->\r\n      <div class=\"address clearFix\" v-for=\"address in tradeInfo.userAddressList\" :key=\"address.id\">\r\n        <span class=\"username\" :class=\"{selected:address.isDefault === '1'}\">{{address.consignee}}</span>\r\n        <p @click=\"changeAddress(address.id)\">\r\n          <span class=\"s1\">{{address.userAddress}}</span>\r\n          <span class=\"s2\">{{address.phoneNum}}</span>\r\n          <span class=\"s3\" v-show=\"address.isDefault === '1' \">默认地址</span>\r\n        </p>\r\n      </div>\r\n\r\n      <div class=\"line\"></div>\r\n      <h5 class=\"pay\">支付方式</h5>\r\n      <div class=\"address clearFix\">\r\n        <span class=\"username selected\" style=\"cursor:pointer\">在线支付</span>\r\n      </div>\r\n      <div class=\"line\"></div>\r\n      <h5 class=\"pay\">商品清单</h5>\r\n      <!-- 商品清单 -->\r\n      <div class=\"detail\">\r\n        <!-- 一个ul就是一个商品 -->\r\n        <ul class=\"list clearFix\" v-for=\"detail in tradeInfo.detailArrayList\" :key=\"detail.skuId\">\r\n          <li>\r\n            <!-- 商品图片 -->\r\n            <img :src=\"detail.imgUrl\" alt=\"\">\r\n          </li>\r\n          <li>\r\n            <!-- 商品名称 -->\r\n            <p> {{detail.skuName}}</p>\r\n          </li>\r\n          <li>\r\n            <!-- 商品价格 -->\r\n            <h3>￥{{detail.orderPrice}}</h3>\r\n          </li>\r\n          <!-- 商品数量 -->\r\n          <li class=\"num\">X{{detail.skuNum}}</li>\r\n          <li class=\"status\">有货</li>\r\n        </ul>\r\n      </div>\r\n\r\n      <div class=\"bbs\">\r\n        <h5>买家留言：</h5>\r\n        <!-- 留言 -->\r\n        <textarea v-model=\"orderComment\" placeholder=\"建议留言前先与商家沟通确认\" class=\"remarks-cont\"></textarea>\r\n      </div>\r\n    </div>\r\n    <div class=\"money clearFix\">\r\n      <ul>\r\n        <li>\r\n          <!-- 总金额 -->\r\n          <b><i>{{tradeInfo.totalNum}}</i>品类，总商品金额</b>\r\n          <span>¥{{tradeInfo.originalTotalAmount}}</span>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class=\"trade\">\r\n      <!-- 应付金额 -->\r\n      <div class=\"price\">应付金额:　<span>¥{{tradeInfo.totalAmount}}</span></div>\r\n      <!-- 邮寄地址 -->\r\n      <div class=\"receiveInfo\">\r\n        寄送至:<span>{{showAddress.userAddress}}</span>\r\n        收货人：<span>{{showAddress.consignee}}</span><span>{{showAddress.phoneNum}}</span>\r\n      </div>\r\n    </div>\r\n    <div class=\"sub clearFix\">\r\n      <a class=\"subBtn\" @click=\"submitOrder\">提交订单</a>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {reqTradeInfo,reqSubmitOrder} from '@/api'\r\n\r\n  export default {\r\n    name: 'Trade',\r\n    data() {\r\n      return {\r\n        tradeInfo:{},\r\n        orderComment:'' //买家留言\r\n      }\r\n    },\r\n    computed: {\r\n      showAddress(){\r\n        return this.tradeInfo.userAddressList?.find((item)=>{\r\n          return item.isDefault === '1'\r\n        }) || {}\r\n      }\r\n    },\r\n    methods: {\r\n      // 用于获取交易信息\r\n      async getTradeInfo(){\r\n        const {code,message,data} = await reqTradeInfo()\r\n        if(code === 200){\r\n          this.tradeInfo = data\r\n        }else{\r\n          this.$message.error(`获取交易信息失败:${message}`)\r\n        }\r\n      },\r\n      // 用户切换收货地址\r\n      changeAddress(id){\r\n        this.tradeInfo.userAddressList.forEach((item)=>{\r\n          item.id === id ? item.isDefault = '1' : item.isDefault = '0'\r\n        })\r\n      },\r\n      // 提交订单\r\n      async submitOrder(){\r\n        // 准备好所有提交订单需要的参数\r\n        const {orderComment} = this\r\n        const {tradeNo,detailArrayList} = this.tradeInfo\r\n        const {userAddress,phoneNum,consignee} = this.showAddress\r\n        // 准备一个包含着所有提交订单所需参数的对象\r\n        const obj = {\r\n          consignee,\r\n          consigneeTel:phoneNum,\r\n          deliveryAddress:userAddress,\r\n          paymentWay:'ONLINE',\r\n          orderComment,\r\n          orderDetailList:detailArrayList\r\n        }\r\n        // 发请求去提交订单（记得要携带【交易编号】）返回的data是订单编号\r\n        const {code,message,data} = await reqSubmitOrder(tradeNo,obj)\r\n        if(code === 200){\r\n          this.$router.push('/pay?id='+data)\r\n        }else{\r\n          this.$message.warning(`提交订单失败：${message}`)\r\n        }\r\n      }\r\n    },\r\n    mounted() {\r\n      this.getTradeInfo()\r\n    },\r\n    beforeRouteEnter(to, from, next) {\r\n      if(from.path === '/shopcart'){\r\n        next()\r\n      }else{\r\n        next('/home')\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .trade-container {\r\n    .title {\r\n      width: 1200px;\r\n      margin: 0 auto;\r\n      font-size: 14px;\r\n      line-height: 21px;\r\n    }\r\n\r\n    .content {\r\n      width: 1200px;\r\n      margin: 10px auto 0;\r\n      border: 1px solid rgb(221, 221, 221);\r\n      padding: 25px;\r\n      box-sizing: border-box;\r\n\r\n      .receive,\r\n      .pay {\r\n        line-height: 36px;\r\n        margin: 18px 0;\r\n      }\r\n\r\n      .address {\r\n        padding-left: 20px;\r\n        margin-bottom: 15px;\r\n\r\n        .username {\r\n          float: left;\r\n          width: 100px;\r\n          height: 30px;\r\n          line-height: 30px;\r\n          text-align: center;\r\n          border: 1px solid #ddd;\r\n          position: relative;\r\n        }\r\n\r\n        .username::after {\r\n          content: \"\";\r\n          display: none;\r\n          width: 13px;\r\n          height: 13px;\r\n          position: absolute;\r\n          right: 0;\r\n          bottom: 0;\r\n          background: url(./images/choosed.png) no-repeat;\r\n        }\r\n\r\n        .username.selected {\r\n          border-color: #e1251b;\r\n        }\r\n\r\n        .username.selected::after {\r\n          display: block;\r\n        }\r\n\r\n        p {\r\n          width: 610px;\r\n          float: left;\r\n          line-height: 30px;\r\n          margin-left: 10px;\r\n          padding-left: 5px;\r\n          cursor: pointer;\r\n\r\n          .s1 {\r\n            float: left;\r\n\r\n          }\r\n\r\n          .s2 {\r\n            float: left;\r\n            margin: 0 5px;\r\n          }\r\n\r\n          .s3 {\r\n            float: left;\r\n            width: 56px;\r\n            height: 24px;\r\n            line-height: 24px;\r\n            margin-left: 10px;\r\n            background-color: #878787;\r\n            color: #fff;\r\n            margin-top: 3px;\r\n            text-align: center;\r\n          }\r\n        }\r\n\r\n        p:hover {\r\n          background-color: #ddd;\r\n        }\r\n      }\r\n\r\n      .line {\r\n        height: 1px;\r\n        background-color: #ddd;\r\n      }\r\n\r\n      .way {\r\n        width: 1080px;\r\n        height: 110px;\r\n        background: #f4f4f4;\r\n        padding: 15px;\r\n        margin: 0 auto;\r\n\r\n        h5 {\r\n          line-height: 50px;\r\n        }\r\n\r\n        .info {\r\n          margin-top: 20px;\r\n\r\n          .s1 {\r\n            float: left;\r\n            border: 1px solid #ddd;\r\n            width: 120px;\r\n            height: 30px;\r\n            line-height: 30px;\r\n            text-align: center;\r\n            margin-right: 10px;\r\n          }\r\n\r\n          p {\r\n            line-height: 30px;\r\n          }\r\n        }\r\n      }\r\n\r\n      .detail {\r\n        width: 1080px;\r\n        // background: #eee;\r\n        // border: 1px solid #ddd;\r\n        border-radius: 5px;\r\n        padding: 15px;\r\n        margin: 2px auto 0;\r\n        img {\r\n          // width: 100px;\r\n          height: 100px;\r\n          box-shadow: 0 0 1px #ccc;\r\n        }\r\n\r\n        h5 {\r\n          line-height: 50px;\r\n        }\r\n\r\n        .list {\r\n          display: flex;\r\n          justify-content: space-between;\r\n          border: 1px solid #ddd;\r\n          margin-bottom: 5px;\r\n          height: 100px;\r\n          .num,.status {\r\n            height: 100px;\r\n            line-height: 100px;\r\n          }\r\n\r\n          li {\r\n            display: flex;\r\n            flex-direction: column;\r\n            justify-content: center;\r\n            p {\r\n              max-width: 300px;\r\n              line-height: 20px;\r\n            }\r\n\r\n            h4 {\r\n              color: #c81623;\r\n              font-weight: 400;\r\n            }\r\n\r\n            h3 {\r\n              height: 100px;\r\n              line-height: 100px;\r\n              color: #e12228;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      .bbs {\r\n        margin-bottom: 15px;\r\n\r\n        h5 {\r\n          line-height: 50px;\r\n        }\r\n\r\n        textarea {\r\n          padding: 10px;\r\n          width: 95%;\r\n          border-color: #e4e2e2;\r\n          line-height: 1.8;\r\n          outline: none;\r\n          resize: none;\r\n        }\r\n      }\r\n\r\n      .bill {\r\n        h5 {\r\n          line-height: 50px;\r\n        }\r\n\r\n        div {\r\n          padding-left: 15px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .money {\r\n      width: 1200px;\r\n      margin: 20px auto;\r\n\r\n      ul {\r\n        width: 220px;\r\n        float: right;\r\n\r\n        li {\r\n          line-height: 30px;\r\n          display: flex;\r\n          justify-content: space-between;\r\n\r\n          i {\r\n            color: red;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .trade {\r\n      box-sizing: border-box;\r\n      width: 1200px;\r\n      padding: 10px;\r\n      margin: 10px auto;\r\n      text-align: right;\r\n      background-color: #f4f4f4;\r\n      border: 1px solid #ddd;\r\n\r\n      div {\r\n        line-height: 30px;\r\n      }\r\n\r\n      .price span {\r\n        color: #e12228;\r\n        font-weight: 700;\r\n        font-size: 14px;\r\n      }\r\n\r\n      .receiveInfo {\r\n        color: #999;\r\n      }\r\n    }\r\n\r\n    .sub {\r\n      width: 1200px;\r\n      margin: 0 auto 10px;\r\n\r\n      .subBtn {\r\n        float: right;\r\n        width: 164px;\r\n        height: 56px;\r\n        font: 700 18px \"微软雅黑\";\r\n        line-height: 56px;\r\n        text-align: center;\r\n        color: #fff;\r\n        background-color: #e1251b;\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n</style>"],"mappings":";AA4EA,SAAAA,YAAA,EAAAC,cAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,SAAA;MACAC,YAAA;IACA;EACA;;EACAC,QAAA;IACAC,YAAA;MACA,YAAAH,SAAA,CAAAI,eAAA,EAAAC,IAAA,CAAAC,IAAA;QACA,OAAAA,IAAA,CAAAC,SAAA;MACA;IACA;EACA;EACAC,OAAA;IACA;IACA,MAAAC,aAAA;MACA;QAAAC,IAAA;QAAAC,OAAA;QAAAZ;MAAA,UAAAH,YAAA;MACA,IAAAc,IAAA;QACA,KAAAV,SAAA,GAAAD,IAAA;MACA;QACA,KAAAa,QAAA,CAAAC,KAAA,aAAAF,OAAA;MACA;IACA;IACA;IACAG,cAAAC,EAAA;MACA,KAAAf,SAAA,CAAAI,eAAA,CAAAY,OAAA,CAAAV,IAAA;QACAA,IAAA,CAAAS,EAAA,KAAAA,EAAA,GAAAT,IAAA,CAAAC,SAAA,SAAAD,IAAA,CAAAC,SAAA;MACA;IACA;IACA;IACA,MAAAU,YAAA;MACA;MACA;QAAAhB;MAAA;MACA;QAAAiB,OAAA;QAAAC;MAAA,SAAAnB,SAAA;MACA;QAAAoB,WAAA;QAAAC,QAAA;QAAAC;MAAA,SAAAnB,WAAA;MACA;MACA,MAAAoB,GAAA;QACAD,SAAA;QACAE,YAAA,EAAAH,QAAA;QACAI,eAAA,EAAAL,WAAA;QACAM,UAAA;QACAzB,YAAA;QACA0B,eAAA,EAAAR;MACA;MACA;MACA;QAAAT,IAAA;QAAAC,OAAA;QAAAZ;MAAA,UAAAF,cAAA,CAAAqB,OAAA,EAAAK,GAAA;MACA,IAAAb,IAAA;QACA,KAAAkB,OAAA,CAAAC,IAAA,cAAA9B,IAAA;MACA;QACA,KAAAa,QAAA,CAAAkB,OAAA,WAAAnB,OAAA;MACA;IACA;EACA;EACAoB,QAAA;IACA,KAAAtB,YAAA;EACA;EACAuB,iBAAAC,EAAA,EAAAC,IAAA,EAAAC,IAAA;IACA,IAAAD,IAAA,CAAAE,IAAA;MACAD,IAAA;IACA;MACAA,IAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}